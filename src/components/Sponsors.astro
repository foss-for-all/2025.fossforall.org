---
import { SponsorLogoWithModal } from "@/components/SponsorLogoWithModal";
import { SponsorsList } from "@/data/sponsors";
import { getLangFromUrl } from "@/i18n/utils";
import { renderMarkdown } from "@/lib/utils";
import type { ui } from "@/i18n/ui";
const lang = getLangFromUrl(Astro.url);
let sponsors = SponsorsList(lang as keyof typeof ui);

// Process markdown in descriptions at build time
sponsors = await Promise.all(sponsors.map(async (group) => ({
  ...group,
  items: await Promise.all(group.items.map(async (item) => ({
    ...item,
    descriptionMarkdown: await renderMarkdown(item.descriptionMarkdown),
  }))),
})));
---

{ sponsors.map((group) => (
  <section>
    <h2 class="title is-size-3 mt-2 mb-1">{group.sponsorClassName}</h2>
    <div style={`display: flex; justify-content: center; align-items: center; flex-wrap: wrap; ${group.sponsorClassName === 'BRONZE' ? 'max-width: 55rem; margin: 0 auto;' : ''}`}>
      {group.items.map((item) => (
        <SponsorLogoWithModal
          client:load
          item={item}
          group={{
            imageHeight: group.imageHeight,
            containerWidth: group.containerWidth,
            containerHeight: group.containerHeight
          }}
        />
      ))}
    </div>
  </section>
)) }
