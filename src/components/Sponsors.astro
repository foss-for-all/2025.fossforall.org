---
import { SponsorLogoWithModal } from "@/components/SponsorLogoWithModal";
import { SponsorsList } from "@/data/sponsors";
import { getLangFromUrl } from "@/i18n/utils";
import { renderMarkdown } from "@/lib/utils";
import type { ui } from "@/i18n/ui";
const lang = getLangFromUrl(Astro.url);
let sponsors = SponsorsList(lang as keyof typeof ui);

// Process markdown in descriptions at build time
sponsors = await Promise.all(sponsors.map(async (group) => ({
  ...group,
  items: await Promise.all(group.items.map(async (item) => ({
    ...item,
    descriptionMarkdown: await renderMarkdown(item.descriptionMarkdown),
  }))),
})));
---

{ sponsors.map((group) => (
  <section>
    <h2 class="title is-size-3 mt-2 mb-1">{group.sponsorClassName}</h2>
    <div class={`fixed-grid ${group.gridClasses}`}>
      <div class="grid">
        {group.items.map((item) => (
          <div class="cell">
            <div style="display: flex; justify-content: center; align-items: center;">
              <SponsorLogoWithModal
                client:load
                item={item}
                group={{
                  imageHeight: group.imageHeight,
                  containerWidth: '100%',
                  containerHeight: group.containerHeight
                }}
              />
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
)) }
